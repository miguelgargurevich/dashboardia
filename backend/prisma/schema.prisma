generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("user")
  createdAt DateTime @default(now())
  tickets   Ticket[]
}

model Ticket {
  id          String              @id @default(cuid())
  tipo        String
  estado      String
  sistema     String?
  descripcion String
  solucion    String?
  archivos    String[]
  userId      String?
  createdAt   DateTime            @default(now())
  closedAt    DateTime?
  events      EventToTicket[]
  resources   ResourceToTicket[]
  user        User?               @relation(fields: [userId], references: [id])
  kbs         TicketToKBArticle[]
}

model KBArticle {
  id          String                @id @default(cuid())
  titulo      String
  tipo        String
  categoria   String?
  descripcion String?
  contenido   String
  archivos    String[]
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  events      EventToKBArticle[]
  resources   ResourceToKBArticle[]
  tickets     TicketToKBArticle[]
}

model Resource {
  id          String                @id @default(cuid())
  tipo        String
  titulo      String
  descripcion String?
  url         String?
  filePath    String?
  tags        String[]
  categoria   String?
  fechaCarga  DateTime              @default(now())
  events      ResourceToEvent[]
  kbs         ResourceToKBArticle[]
  tickets     ResourceToTicket[]
}

model Event {
  id                 String             @id @default(cuid())
  title              String
  description        String?
  startDate          DateTime
  endDate            DateTime
  location           String?
  createdAt          DateTime           @default(now())
  codigoDana         String?
  diaEnvio           String?
  modo               String?
  nombreNotificacion String?
  query              String?
  validador          String?
  kbs                EventToKBArticle[]
  tickets            EventToTicket[]
  resources          ResourceToEvent[]
}

model TicketToKBArticle {
  ticketId String
  kbId     String
  kb       KBArticle @relation(fields: [kbId], references: [id])
  ticket   Ticket    @relation(fields: [ticketId], references: [id])

  @@id([ticketId, kbId])
}

model ResourceToTicket {
  resourceId String
  ticketId   String
  resource   Resource @relation(fields: [resourceId], references: [id])
  ticket     Ticket   @relation(fields: [ticketId], references: [id])

  @@id([resourceId, ticketId])
}

model ResourceToKBArticle {
  resourceId String
  kbId       String
  kb         KBArticle @relation(fields: [kbId], references: [id])
  resource   Resource  @relation(fields: [resourceId], references: [id])

  @@id([resourceId, kbId])
}

model ResourceToEvent {
  resourceId String
  eventId    String
  event      Event    @relation(fields: [eventId], references: [id])
  resource   Resource @relation(fields: [resourceId], references: [id])

  @@id([resourceId, eventId])
}

model EventToTicket {
  eventId  String
  ticketId String
  event    Event  @relation(fields: [eventId], references: [id])
  ticket   Ticket @relation(fields: [ticketId], references: [id])

  @@id([eventId, ticketId])
}

model EventToKBArticle {
  eventId String
  kbId    String
  event   Event     @relation(fields: [eventId], references: [id])
  kb      KBArticle @relation(fields: [kbId], references: [id])

  @@id([eventId, kbId])
}
